# 🎵 音频转录工具 - 功能总结

## 🆕 最新功能

### 1. 递归处理子文件夹 ✨
- **功能**：自动处理文件夹及其所有子文件夹中的音频文件
- **特点**：
  - 🔍 深度扫描所有层级的子文件夹
  - 📁 显示文件的完整相对路径
  - 💾 SRT文件保存在与原音频文件相同的位置
  - 📊 处理进度显示文件夹结构

### 2. 失败文件自动记录 🆕
- **功能**：自动保存处理失败文件的详细信息
- **保存位置**：`failed_files/` 文件夹
- **文件格式**：
  - `failed_files_时间戳.json` - 详细信息（程序可读）
  - `failed_list_时间戳.txt` - 文件列表（人类可读）

### 3. 失败文件重新处理 🔄
- **脚本**：`重新处理失败文件.py`
- **功能**：
  - 📋 列出所有失败文件记录
  - 🔍 选择要重新处理的记录
  - 🔄 批量重新处理失败文件
  - 📊 显示重新处理结果

### 4. 模型信息显示 🤖
- **功能**：在程序启动时显示使用的AI模型
- **信息**：从 `.env` 文件读取 `GEMINI_MODEL_NAME`
- **默认**：`gemini-2.0-flash`

### 5. 去除用户确认 ⚡
- **改进**：去除了"是否继续处理"的询问
- **效果**：程序直接开始处理，提高效率

## 📁 支持的文件结构

### 简单结构
```
课程/
├── 第1课.mp3 → 第1课.srt
├── 第2课.wav → 第2课.srt
└── 第3课.m4a → 第3课.srt
```

### 复杂嵌套结构
```
课程/
├── 第一章/
│   ├── 1-1.mp3 → 1-1.srt
│   ├── 1-2.mp3 → 1-2.srt
│   └── 子章节/
│       └── 1-1-1.wav → 1-1-1.srt
├── 第二章/
│   ├── 2-1.m4a → 2-1.srt
│   └── 2-2.flac → 2-2.srt
└── 总结.mp3 → 总结.srt
```

## 🛠️ 错误处理机制

### 网络错误类型
1. **代理连接问题**
   - `ProxyError('Unable to connect to proxy')`
   - 代理服务器配置或稳定性问题

2. **连接中断**
   - `RemoteDisconnected('Remote end closed connection without response')`
   - 网络不稳定或服务器超时

3. **重试耗尽**
   - `Max retries exceeded`
   - 已达到最大重试次数

### 解决方案
1. **立即解决**：
   - 检查网络连接
   - 更换网络环境
   - 检查代理设置

2. **延后处理**：
   - 使用失败文件记录功能
   - 稍后运行重新处理脚本

## 📊 处理流程

### 正常处理流程
```
1. 启动程序 → 2. 扫描文件夹 → 3. 显示文件列表 → 4. 逐个处理 → 5. 生成SRT文件
```

### 失败处理流程
```
1. 处理失败 → 2. 记录失败信息 → 3. 保存到failed_files/ → 4. 继续处理其他文件
```

### 重新处理流程
```
1. 运行重新处理脚本 → 2. 选择失败记录 → 3. 重新处理 → 4. 更新结果
```

## 🎯 使用建议

### 日常使用
1. **首选**：`python 启动.py`
2. **输入文件夹路径**
3. **等待处理完成**

### 网络不稳定时
1. **正常处理**：让程序记录失败文件
2. **稍后重试**：`python 重新处理失败文件.py`
3. **重复直到全部成功**

### 大批量处理
1. **分批处理**：将文件分到不同文件夹
2. **监控失败率**：如果失败率高，检查网络
3. **使用重新处理**：处理失败的文件

## 📄 生成的文件

### 成功处理
- `原文件名.srt` - 字幕文件（与音频文件同位置）

### 失败记录
- `failed_files/failed_files_时间戳.json` - 详细信息
- `failed_files/failed_list_时间戳.txt` - 文件列表

### 日志文件
- `logs/audio_processing.log` - 程序运行日志

## 🔧 配置文件

### .env 文件
```env
GEMINI_API_KEY=your_api_key_here
GEMINI_MODEL_NAME=gemini-2.0-flash
```

### config/default_prompt.txt
- 自定义转录提示词
- 影响转录质量和格式

## 💡 最佳实践

1. **网络环境**：使用稳定的网络连接
2. **文件组织**：按章节或主题组织文件夹
3. **批量大小**：单次处理不超过50个文件
4. **失败处理**：及时重新处理失败文件
5. **备份重要**：重要文件建议多次尝试

## 🎉 总结

现在的音频转录工具具备：
- ✅ 递归处理任意复杂的文件夹结构
- ✅ 自动记录和重新处理失败文件
- ✅ 显示详细的处理信息和进度
- ✅ 稳定的HTTP API连接
- ✅ 完善的错误处理机制

无论您的音频文件如何组织，工具都能智能处理并生成对应的字幕文件！
